<html>

  <script src='/socket.io/socket.io.js'></script>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script>
      var socket = io.connect('http://localhost/admin');
      var progressBarPrefix = '<div class="progress progress-striped active">';
      var progressBarInnerPrefix = '<div id="progressBar_';

      var progressBarInnerPostfix = '" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div>';
      var progressBarPostfix = '</div>';

      var taskResultPrefix = '<textarea readonly style="width: 100%" id="result_';
      var taskResultInfix = '">';
      var taskResultPostfix = '</textarea>';

      function sendCommand() {
        console.log('sending command...');
        var command = document.getElementById('command').value;
        socket.emit('command', command);
      }

      function increaseProgress(element, value){
        element.style.width = value + '%';
        element['aria-valuenow'] = value;
        element.innerHTML = value + '%';
      };

      socket.on('started', function (payload){
        taskId = payload.taskId;
        progressBar = progressBarPrefix + progressBarInnerPrefix + taskId + progressBarInnerPostfix + progressBarPostfix;
        console.log("Appending: " + progressBar);
        $("#progressContainer").append(progressBar);
      });

      socket.on('error', function (payload){
        taskId = payload.taskId;
        details = payload.details;
        taskResult = taskResultPrefix + taskId + taskResultInfix + details + taskResultPostfix
        $("#progressContainer").append(taskResult);
      });

      socket.on('invalid', function(){
        alert("Provided task is malformed");
      });

      socket.on('result', function (payload){
        taskId = payload.taskId;
        result = payload.result;
        taskResult = taskResultPrefix + taskId + taskResultInfix + result + taskResultPostfix;
        $("#progressBar_" + taskId).replaceWith(taskResult)
      });

      socket.on('progress', function (payload){
        taskId = payload.taskId;
        progress = payload.progress;
        increaseProgress($("#progressBar_" + taskId)[0], progress);
      });

  </script>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
        <link href="bootstrap/css/bootstrap-theme.css" rel="stylesheet">

    </head>

  <body role="document">
        <!-- Fixed navbar -->
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">IO2014</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#send">Task sending</a></li>
                        <li><a href="#execution">Execution</a></li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </div>

        <div class="container theme-showcase" role="main">

            <br>
            <br>
            <br>
            <br>

            <div class="jumbotron">
                <h1>Volunteer computing</h1>
            </div>

            <div class="page-header">
                <h1><a id="send">Task sending</a></h1>
            </div>

            <div class="page-header">
                <h3>Here we can post tasks to execute</h3>
            </div>

            <div class="col-md-12">
                <textarea style="margin-bottom: 50px; height: 400px; width: 100%" id='command'></textarea>
            </div>

            <div class="col-md-12 btn-group btn-group-justified">
              <div class="btn-group">
                <button type="button" class="btn btn-lg btn-primary" onclick="sendCommand()">Send</button>
              </div>
            </div>
            
            <div class="col-md-12" style="margin-bottom: 50px">
                <div class="page-header">
                  <h1><a id="execution">Execution</a></h1>
                </div>

                <div id="progressContainer" class="col-md-12">

                </div>
            </div>

        </div>
    </body>

</html>

